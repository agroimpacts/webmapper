<!DOCTYPE html>
<html>
<head>
    <title>PMTiles OpenLayers Vector with MapTiler Hybrid Base Map</title>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/ol@v7.3.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.3.0/ol.css">
    <script src="https://unpkg.com/ol-pmtiles@0.3.0/dist/olpmtiles.js"></script>
    <style>
        body, #map {
            height: 100vh;
            margin: 0;
        }

        /* Dropdown styles */
        .dropdown {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .dropdown > div {
            position: relative;
        }

        .dropdown button {
            background-color: white;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .dropdown > div:hover .dropdown-content {
            display: block;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
        // MapTiler hybrid base layer
        const hybridBaseLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
                url: 'https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=0rXt9evmwC5e2EW3sauy',
                attributions: '© MapTiler © OpenStreetMap contributors',
                maxZoom: 20
            })
        });

        // Map of country, year, and version to PMTiles URL
        const pмTilesSources = {
            Congo: {
                '2018': {
                    'v1': 'https://raw.githack.com/grace-du/crop-land-maps/main/congo.pmtiles',
                    'v2': 'https://example.com/congo-2018-v2.pmtiles',
                    'v3': 'https://example.com/congo-2018-v3.pmtiles'
                },
                '2019': {
                    'v1': 'https://example.com/congo-2019-v1.pmtiles',
                    'v2': 'https://example.com/congo-2019-v2.pmtiles',
                    'v3': 'https://example.com/congo-2019-v3.pmtiles'
                },
                '2020': {
                    'v1': 'https://example.com/congo-2020-v1.pmtiles',
                    'v2': 'https://example.com/congo-2020-v2.pmtiles',
                    'v3': 'https://example.com/congo-2020-v3.pmtiles'
                },
                '2021': {
                    'v1': 'https://example.com/congo-2021-v1.pmtiles',
                    'v2': 'https://example.com/congo-2021-v2.pmtiles',
                    'v3': 'https://example.com/congo-2021-v3.pmtiles'
                },
                '2022': {
                    'v1': 'https://example.com/congo-2022-v1.pmtiles',
                    'v2': 'https://example.com/congo-2022-v2.pmtiles',
                    'v3': 'https://example.com/congo-2022-v3.pmtiles'
                },
                '2023': {
                    'v1': 'https://example.com/congo-2023-v1.pmtiles',
                    'v2': 'https://example.com/congo-2023-v2.pmtiles',
                    'v3': 'https://example.com/congo-2023-v3.pmtiles'
                }
            },
            Ghana: {
                '2018': {
                    'v1': 'https://example.com/ghana-2018-v1.pmtiles',
                    'v2': 'https://example.com/ghana-2018-v2.pmtiles',
                    'v3': 'https://example.com/ghana-2018-v3.pmtiles'
                },
                '2019': {
                    'v1': 'https://example.com/ghana-2019-v1.pmtiles',
                    'v2': 'https://example.com/ghana-2019-v2.pmtiles',
                    'v3': 'https://example.com/ghana-2019-v3.pmtiles'
                },
                '2020': {
                    'v1': 'https://example.com/ghana-2020-v1.pmtiles',
                    'v2': 'https://example.com/ghana-2020-v2.pmtiles',
                    'v3': 'https://example.com/ghana-2020-v3.pmtiles'
                },
                '2021': {
                    'v1': 'https://example.com/ghana-2021-v1.pmtiles',
                    'v2': 'https://example.com/ghana-2021-v2.pmtiles',
                    'v3': 'https://example.com/ghana-2021-v3.pmtiles'
                },
                '2022': {
                    'v1': 'https://example.com/ghana-2022-v1.pmtiles',
                    'v2': 'https://example.com/ghana-2022-v2.pmtiles',
                    'v3': 'https://example.com/ghana-2022-v3.pmtiles'
                },
                '2023': {
                    'v1': 'https://example.com/ghana-2023-v1.pmtiles',
                    'v2': 'https://example.com/ghana-2023-v2.pmtiles',
                    'v3': 'https://example.com/ghana-2023-v3.pmtiles'
                }
            }
        };

        // OpenLayers map with the new base layer and vector layer
        const map = new ol.Map({
            layers: [hybridBaseLayer],
            target: 'map',
            view: new ol.View({
                center: ol.proj.fromLonLat([3.3, 7.85]),
                zoom: 5
            })
        });

        // Congo extent (center and zoom)
        const congoCenter = ol.proj.fromLonLat([15.8277, -0.2280]);
        const congoZoom = 7;
        const ghanaCenter = ol.proj.fromLonLat([-0.2, 7.95]);
        const ghanaZoom = 7;

        // Add the vector layer when a country, year, and version are selected
        let vectorLayer;

        function zoomToCountry(country, year, version) {
            if (!vectorLayer) {
                vectorLayer = new ol.layer.VectorTile({
                    declutter: true,
                    source: new olpmtiles.PMTilesVectorSource({
                        url: pмTilesSources[country][year][version]
                    }),
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: 'blue',
                            width: 1,
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(0,0,0,0)', //polygon fill transparent
                        })
                    })
                });
                map.addLayer(vectorLayer);
            } else {
                vectorLayer.getSource().setUrl(pмTilesSources[country][year][version]);
            }

            let center, zoom;
            switch (country) {
                case 'Congo':
                    center = congoCenter;
                    zoom = congoZoom;
                    break;
                case 'Ghana':
                    center = ghanaCenter;
                    zoom = ghanaZoom;
                    break;
            }

            map.getView().animate({
                center: center,
                zoom: zoom,
                duration: 1000 // Smooth transition animation (1 second)
            });

            updateDropdownButtonText(country, year, version);
        }

        // Function to update the dropdown button text
        function updateDropdownButtonText(country, year, version) {
            countryButton.textContent = `Country: ${country}`;
            yearButton.textContent = `Year: ${year}`;
            versionButton.textContent = `Version: ${version}`;
        }

        // Create and append the dropdowns
        const dropdown = document.createElement('div');
        dropdown.className = 'dropdown';

        // Country dropdown
        const countryDropdown = document.createElement('div');
        const countryButton = document.createElement('button');
        countryButton.textContent = 'Country';
        const countryContent = document.createElement('div');
        countryContent.className = 'dropdown-content';
        ['Congo', 'Ghana'].forEach(country => {
            const countryLink = document.createElement('a');
            countryLink.textContent = country;
            countryLink.onclick = () => {
                updateYearDropdown(country);
                updateVersionDropdown(country, '2018');
                zoomToCountry(country, '2018', 'v1');
            };
            countryContent.appendChild(countryLink);
        });
        countryDropdown.appendChild(countryButton);
        countryDropdown.appendChild(countryContent);

        // Year dropdown
        const yearDropdown = document.createElement('div');
        const yearButton = document.createElement('button');
        yearButton.textContent = 'Year';
        const yearContent = document.createElement('div');
        yearContent.className = 'dropdown-content';

        // Version dropdown
        const versionDropdown = document.createElement('div');
        const versionButton = document.createElement('button');
        versionButton.textContent = 'Version';
        const versionContent = document.createElement('div');
        versionContent.className = 'dropdown-content';

        // Function to update the year dropdown
        function updateYearDropdown(country) {
            yearContent.innerHTML = '';
            Object.keys(pмTilesSources[country]).forEach(year => {
                const yearLink = document.createElement('a');
                yearLink.textContent = year;
                yearLink.onclick = () => {
                    updateVersionDropdown(country, year);
                    zoomToCountry(country, year, 'v1');
                };
                yearContent.appendChild(yearLink);
            });
        }

        // Function to update the version dropdown
        function updateVersionDropdown(country, year) {
            versionContent.innerHTML = '';
            Object.keys(pмTilesSources[country][year]).forEach(version => {
                const versionLink = document.createElement('a');
                versionLink.textContent = version;
                versionLink.onclick = () => zoomToCountry(country, year, version);
                versionContent.appendChild(versionLink);
            });
        }

        yearDropdown.appendChild(yearButton);
        yearDropdown.appendChild(yearContent);

        versionDropdown.appendChild(versionButton);
        versionDropdown.appendChild(versionContent);

        dropdown.appendChild(countryDropdown);
        dropdown.appendChild(yearDropdown);
        dropdown.appendChild(versionDropdown);
        document.getElementById('map').appendChild(dropdown);
    </script>
</body>
</html>